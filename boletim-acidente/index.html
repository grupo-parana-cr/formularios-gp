<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Boletim de Acidente - Grupo Paran√°</title>
  <style>
    :root {
      --primary-blue: #004ac9;
      --primary-red: #ed383b;
      --dark-blue: #003580;
      --light-gray: #f5f7fa;
      --text-primary: #2c3e50;
      --text-secondary: #7f8c8d;
      --border-color: #e0e6ed;
      --success-green: #27ae60;
      --error-red: #e74c3c;
      --white: #ffffff;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, sans-serif;
      background: var(--light-gray);            /* ‚úÖ volta ao fundo mais delicado (Vers√£o 1) */
      color: var(--text-primary);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      background: var(--white);
      min-height: 100vh;
      box-shadow: 0 2px 12px rgba(0,0,0,.04);   /* ‚úÖ sombra sutil */
    }

    /* ===== Header mais clean ===== */
    .header {
      background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue));
      color: white;
      padding: 24px 20px 28px;
      text-align: center;
    }
    .header .logo {
      background: white;
      padding: 10px;
      border-radius: 12px;
      margin: 0 auto 16px;
      max-width: 96px;
      box-shadow: 0 2px 10px rgba(0,0,0,.12);
    }
    .header h1 {
      font-size: 1.45rem;        /* ‚úÖ tipografia mais elegante e menos ‚Äúpesada‚Äù */
      font-weight: 700;
      letter-spacing: 0;         /* ‚úÖ remove exageros */
      margin-bottom: 6px;
    }
    .header p {
      font-size: .95rem;
      opacity: .95;
      font-weight: 500;
    }

    .form-container { padding: 24px 20px; }
    .form-section { margin-bottom: 22px; }

    .section-title {
      color: var(--primary-blue);
      font-size: .85rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .4px;
      margin-bottom: 14px;
      padding-bottom: 8px;
      border-bottom: 2px solid var(--primary-red);
    }

    .form-group { margin-bottom: 16px; }
    label {
      display: block;
      font-weight: 600;           /* ‚úÖ reduz peso da fonte */
      color: var(--text-primary);
      margin-bottom: 8px;
      font-size: .95rem;
    }
    label.required::after { content: " *"; color: var(--error-red); }
    label.optional { font-weight: 500; color: var(--text-secondary); }
    label.optional::after { content: " (opcional)"; font-size: .85em; font-weight: 400; }

    input[type="text"],
    input[type="date"],
    input[type="time"],
    input[type="tel"],
    textarea,
    select {
      width: 100%;
      padding: 14px 14px;
      border: 2px solid var(--border-color);
      border-radius: 10px;
      font-size: 16px;
      font-family: inherit;
      transition: all .25s ease;
      background: var(--white);
      color: var(--text-primary);
      display: block;
    }
    input[type="date"],
    input[type="time"] {
      -webkit-appearance: none;
      appearance: none;
    }
    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 3px rgba(0,74,201,.12);
    }
    textarea { resize: vertical; min-height: 120px; line-height: 1.6; }

    /* ===== Radios ===== */
    .radio-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    @media (max-width: 420px) { .radio-group { grid-template-columns: 1fr; } }
    .radio-item input[type="radio"] { display: none; }
    .radio-item label {
      display: block; text-align: center; cursor: pointer;
      padding: 14px 18px; border: 2px solid var(--border-color);
      border-radius: 10px; background: var(--white);
      font-weight: 600; transition: all .25s ease;
    }
    .radio-item input[type="radio"]:checked + label {
      background: var(--primary-blue); color: white; border-color: var(--primary-blue);
      transform: scale(1.02);
    }

    /* ===== Upload de fotos ===== */
    .photo-upload-area {
      border: 2px dashed var(--border-color);
      border-radius: 12px;
      padding: 22px;
      text-align: center;
      cursor: pointer;
      transition: all .25s ease;
      background: var(--light-gray);
    }
    .photo-upload-area.dragover {
      border-color: var(--primary-blue);
      background: rgba(0,74,201,.05);
    }
    .photo-icon { font-size: 2.6rem; margin-bottom: 8px; }
    .photo-text { font-weight: 600; margin-bottom: 4px; }
    .photo-hint { font-size: .85rem; color: var(--text-secondary); }
    .photo-preview-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(92px,1fr));
      gap: 10px; margin-top: 12px;
    }
    .photo-preview-item {
      position: relative; border-radius: 10px; overflow: hidden; aspect-ratio: 1;
      box-shadow: 0 2px 8px rgba(0,0,0,.08);
    }
    .photo-preview-item img { width: 100%; height: 100%; object-fit: cover; }
    .photo-remove-btn {
      position: absolute; top: 6px; right: 6px;
      background: var(--error-red); color: white; border: none; border-radius: 50%;
      width: 26px; height: 26px; font-size: 16px; cursor: pointer;
      display: flex; align-items: center; justify-content: center; transition: transform .2s;
    }
    .photo-remove-btn:active { transform: scale(.92); }

    /* ===== WhatsApp ===== */
    .whatsapp-option {
      display: flex; align-items: center; gap: 12px;
      padding: 14px;
      background: var(--light-gray);
      border-radius: 10px;
      margin-bottom: 10px;
      cursor: pointer; user-select: none; -webkit-tap-highlight-color: transparent;
    }
    .whatsapp-option input[type="checkbox"] { width: 22px; height: 22px; cursor: pointer; flex-shrink: 0; }
    .whatsapp-option label { margin: 0; cursor: pointer; flex: 1; }
    .whatsapp-icon { font-size: 1.4rem; }
    .whatsapp-input-container { display: none; margin-top: 10px; }
    .whatsapp-input-container.show { display: block; animation: slideDown .25s ease; }
    @keyframes slideDown { from { opacity: 0; transform: translateY(-8px);} to {opacity:1; transform: translateY(0);} }

    /* ===== Submit stick ===== */
    .submit-container {
      position: sticky; bottom: 0;
      padding: 14px 20px; background: white;
      border-top: 1px solid var(--border-color);
      box-shadow: 0 -4px 18px rgba(0,0,0,.05);
    }
    .submit-btn {
      width: 100%; padding: 15px;
      background: linear-gradient(135deg, var(--primary-red), #c92f32);
      color: white; border: none; border-radius: 12px;
      font-size: 1.05rem; font-weight: 700;
      cursor: pointer; transition: all .2s ease;
      box-shadow: 0 4px 14px rgba(237,56,59,.28);
    }
    .submit-btn:active { transform: scale(.985); }
    .submit-btn:disabled { background: var(--text-secondary); cursor: not-allowed; opacity:.65; box-shadow: none; }
    .submit-btn.loading::after {
      content: ""; margin-left: 8px; display: inline-block; width: 16px; height: 16px;
      border: 2px solid white; border-radius: 50%; border-top-color: transparent; animation: spin .8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg);} }

    .error-message { color: var(--error-red); font-size: .85rem; margin-top: 6px; display: none; }
    .form-group.error input, .form-group.error textarea, .form-group.error select { border-color: var(--error-red); }
    .form-group.error .error-message { display: block; }

    /* ===== Duas colunas responsivas s√≥ para Data/Hora (>=480px) ===== */
    .grid-2 {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    @media (min-width: 480px) {
      .grid-2 { grid-template-columns: 1fr 1fr; } /* ‚úÖ no mobile empilha; em telas maiores fica lado a lado */
    }

    /* ===== Modal de Sucesso (clean) ===== */
    .success-modal {
      display: none; position: fixed; inset: 0;
      background: rgba(0,0,0,.8); z-index: 1000;
      align-items: center; justify-content: center; padding: 20px;
    }
    .success-modal.show { display: flex; }
    .success-content {
      background: white; padding: 28px 22px; border-radius: 16px; text-align: center; width: 420px; max-width: 92%;
      box-shadow: 0 18px 64px rgba(0,0,0,.25);
      animation: modalPop .35s ease;
    }
    .success-icon { font-size: 3.4rem; margin-bottom: 10px; }
    .success-content h2 { color: var(--success-green); margin-bottom: 8px; }
    .success-content p { color: var(--text-secondary); margin-bottom: 10px; line-height: 1.7; }
    .success-content p strong { color: var(--primary-blue); font-weight: 700; }
    .success-btn { padding: 12px 26px; background: var(--primary-blue); color: white; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; margin-top: 8px; }
    @keyframes modalPop { from { opacity: 0; transform: scale(.9);} to { opacity: 1; transform: scale(1);} }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="../img/logo-grupo-parana.png" alt="Logo Grupo Paran√°" class="logo" />
      <h1>‚ö†Ô∏è Boletim de Acidente</h1>
      <p>Registro Inicial de Ocorr√™ncia</p>
    </div>

    <form id="boletimForm" class="form-container" novalidate>
      <!-- Se√ß√£o 1: Tipo de Ocorr√™ncia -->
      <div class="form-section">
        <div class="section-title">üìã Tipo de Ocorr√™ncia</div>
        <div class="form-group">
          <label class="required">Selecione o tipo</label>
          <div class="radio-group">
            <div class="radio-item">
              <input type="radio" id="tipoAcidente" name="tipo" value="acidente" required />
              <label for="tipoAcidente">üö® Acidente</label>
            </div>
            <div class="radio-item">
              <input type="radio" id="tipoIncidente" name="tipo" value="incidente" required />
              <label for="tipoIncidente">‚ö†Ô∏è Incidente</label>
            </div>
          </div>
          <div class="error-message">Selecione o tipo de ocorr√™ncia</div>
        </div>
      </div>

      <!-- Se√ß√£o 2: Data e Hora (corrigido o desalinhamento mobile) -->
      <div class="form-section">
        <div class="section-title">üìÖ Data e Hora</div>
        <div class="grid-2">
          <div class="form-group">
            <label for="data" class="required">Data</label>
            <input type="date" id="data" name="data" required />
            <div class="error-message">Campo obrigat√≥rio</div>
          </div>
          <div class="form-group">
            <label for="hora" class="required">Hora</label>
            <input type="time" id="hora" name="hora" required />
            <div class="error-message">Campo obrigat√≥rio</div>
          </div>
        </div>
      </div>

      <!-- Se√ß√£o 3: Local -->
      <div class="form-section">
        <div class="section-title">üìç Local</div>
        <div class="form-group">
          <label for="local" class="required">Endere√ßo/Local da ocorr√™ncia</label>
          <input type="text" id="local" name="local" placeholder="Ex: Rua Leandro Ortiz Menezes n.401" required />
          <div class="error-message">Campo obrigat√≥rio</div>
        </div>
      </div>

      <!-- Se√ß√£o 4: Dados Gerais -->
      <div class="form-section">
        <div class="section-title">üè¢ Dados Gerais</div>
        <div class="form-group">
          <label for="empresa" class="required">Empresa</label>
          <input type="text" id="empresa" name="empresa" placeholder="Nome da empresa" required />
          <div class="error-message">Campo obrigat√≥rio</div>
        </div>
      </div>

      <!-- Se√ß√£o 5: Quem est√° reportando -->
      <div class="form-section">
        <div class="section-title">üì¢ Quem est√° reportando</div>
        <div class="form-group">
          <label for="comunicante" class="required">Seu nome (quem est√° registrando)</label>
          <input type="text" id="comunicante" name="comunicante" placeholder="Seu nome completo" required />
          <div class="error-message">Campo obrigat√≥rio</div>
        </div>
      </div>

      <!-- Se√ß√£o 6: Pessoa Envolvida no Acidente -->
      <div class="form-section">
        <div class="section-title">üë§ Pessoa Envolvida no Acidente</div>
        <div class="form-group">
          <label for="colaborador" class="required">Nome da pessoa acidentada</label>
          <input type="text" id="colaborador" name="colaborador" placeholder="Nome completo da v√≠tima" required />
          <div class="error-message">Campo obrigat√≥rio</div>
        </div>
      </div>

      <!-- Se√ß√£o 7: Relato -->
      <div class="form-section">
        <div class="section-title">üìù Breve Relato</div>
        <div class="form-group">
          <label for="relato" class="required">Descreva o ocorrido</label>
          <textarea id="relato" name="relato" placeholder="Descreva brevemente o que aconteceu..." required></textarea>
          <div class="error-message">Campo obrigat√≥rio</div>
        </div>
      </div>

      <!-- Se√ß√£o 8: Fotos -->
      <div class="form-section">
        <div class="section-title">üì∑ Fotos</div>
        <div class="form-group">
          <label class="optional">Fotos do local/acidente</label>
          <div class="photo-upload-area" id="photoUploadArea">
            <div class="photo-icon">üì∏</div>
            <div class="photo-text">Toque para adicionar fotos</div>
            <div class="photo-hint">C√¢mera ou Galeria ‚Ä¢ M√°ximo 5 fotos ‚Ä¢ At√© 5MB cada</div>
            <input type="file" id="photoInput" accept="image/*" multiple style="display:none" />
          </div>
          <div class="photo-preview-grid" id="photoPreviewGrid"></div>
        </div>
      </div>

      <!-- Se√ß√£o 9: WhatsApp -->
      <div class="form-section">
        <div class="section-title">üí¨ Notifica√ß√£o WhatsApp</div>
        <div class="whatsapp-option" onclick="document.getElementById('receberWhatsapp').click();">
          <span class="whatsapp-icon">üì±</span>
          <input type="checkbox" id="receberWhatsapp" name="receberWhatsapp" onclick="event.stopPropagation();" />
          <label for="receberWhatsapp" onclick="event.stopPropagation();">Quero receber uma c√≥pia via WhatsApp</label>
        </div>
        <div class="whatsapp-input-container" id="whatsappInputContainer">
          <div class="form-group">
            <label for="whatsapp" class="optional">Meu n√∫mero de WhatsApp</label>
            <input type="tel" id="whatsapp" name="whatsapp" placeholder="(67) 99921-7329" maxlength="15" />
            <div class="error-message">N√∫mero inv√°lido</div>
          </div>
        </div>
      </div>
    </form>

    <div class="submit-container">
      <button type="submit" form="boletimForm" class="submit-btn" id="submitBtn">Enviar Boletim</button>
    </div>
  </div>

  <!-- Modal Sucesso -->
  <div class="success-modal" id="successModal">
    <div class="success-content">
      <div class="success-icon">‚úÖ</div>
      <h2>Boletim Enviado!</h2>
      <div id="successDetails">
        <p>O registro foi enviado com sucesso.</p>
      </div>
      <button class="success-btn" onclick="location.reload()">Registrar Novo</button>
    </div>
  </div>

  <script>
    let uploadedPhotos = [];
    const maxPhotos = 5;
    const maxFileSize = 5 * 1024 * 1024;
    let userSelectedWhatsApp = false;

    // M√°scara WhatsApp
    const whatsappInput = document.getElementById("whatsapp");
    whatsappInput.addEventListener("input", function (e) {
      let value = e.target.value.replace(/\\D/g, "");
      if (value.length <= 11) {
        value = value.replace(/^(\\d{2})(\\d)/g, "($1) $2");
        value = value.replace(/(\\d)(\\d{4})$/, "$1-$2");
      }
      e.target.value = value;
    });

    // Toggle WhatsApp
    document.getElementById("receberWhatsapp").addEventListener("change", function (e) {
      const container = document.getElementById("whatsappInputContainer");
      userSelectedWhatsApp = e.target.checked;
      if (e.target.checked) {
        container.classList.add("show");
        whatsappInput.focus();
      } else {
        container.classList.remove("show");
        whatsappInput.value = "";
      }
    });

    // Upload de fotos
    const photoUploadArea = document.getElementById("photoUploadArea");
    const photoInput = document.getElementById("photoInput");
    const photoPreviewGrid = document.getElementById("photoPreviewGrid");

    photoUploadArea.addEventListener("click", function () {
      if (uploadedPhotos.length < maxPhotos) photoInput.click();
      else alert(`M√°ximo de ${maxPhotos} fotos permitidas`);
    });
    photoUploadArea.addEventListener("touchend", function (e) {
      e.preventDefault();
      if (uploadedPhotos.length < maxPhotos) photoInput.click();
      else alert(`M√°ximo de ${maxPhotos} fotos permitidas`);
    });
    photoUploadArea.addEventListener("dragover", (e) => {
      e.preventDefault(); photoUploadArea.classList.add("dragover");
    });
    photoUploadArea.addEventListener("dragleave", () => {
      photoUploadArea.classList.remove("dragover");
    });
    photoUploadArea.addEventListener("drop", (e) => {
      e.preventDefault(); photoUploadArea.classList.remove("dragover"); handleFiles(e.dataTransfer.files);
    });
    photoInput.addEventListener("change", (e) => { handleFiles(e.target.files); });

    function handleFiles(files) {
      for (let file of files) {
        if (uploadedPhotos.length >= maxPhotos) { alert(`M√°ximo de ${maxPhotos} fotos permitidas`); break; }
        if (!file.type.startsWith("image/")) { alert("Apenas imagens s√£o permitidas"); continue; }
        if (file.size > maxFileSize) { alert(`${file.name} excede o tamanho m√°ximo de 5MB`); continue; }
        uploadedPhotos.push(file);
        createPhotoPreview(file, uploadedPhotos.length - 1);
      }
      photoInput.value = "";
    }

    function createPhotoPreview(file, index) {
      const reader = new FileReader();
      reader.onload = (e) => {
        const div = document.createElement("div");
        div.className = "photo-preview-item";
        div.innerHTML = \`
          <img src="\${e.target.result}" alt="Foto \${index + 1}" />
          <button type="button" class="photo-remove-btn" onclick="removePhoto(\${index})">√ó</button>\`;
        photoPreviewGrid.appendChild(div);
      };
      reader.readAsDataURL(file);
    }

    function removePhoto(index) {
      uploadedPhotos.splice(index, 1);
      photoPreviewGrid.innerHTML = "";
      uploadedPhotos.forEach((file, i) => createPhotoPreview(file, i));
    }

    // Modal de sucesso
    function showSuccessModal(data) {
      const modal = document.getElementById("successModal");
      const details = document.getElementById("successDetails");
      let whatsappMessage = "";
      if (userSelectedWhatsApp) {
        whatsappMessage = \`
          <p style="font-size:.95em; color: var(--text-secondary); margin-top: 10px; padding: 10px; background:#f0f9ff; border-radius:8px; border-left:3px solid var(--primary-blue);">
            üì± Em breve voc√™ receber√° uma confirma√ß√£o via WhatsApp.
          </p>\`;
      }
      details.innerHTML = \`
        <p><strong>Protocolo:</strong> \${data?.data?.registroId || "N/A"}</p>
        <p><strong>Tipo:</strong> \${(data?.data?.tipo || "N/A").toString().toUpperCase()}</p>
        <p style="margin-top: 10px;">\${data?.message || "Boletim registrado e enviado com sucesso!"}</p>
        \${whatsappMessage}\`;
      modal.classList.add("show");
    }

    // Valida√ß√£o
    function validateForm() {
      let isValid = true;
      const form = document.getElementById("boletimForm");
      form.querySelectorAll(".form-group").forEach((g) => g.classList.remove("error"));
      form.querySelectorAll("[required]").forEach((field) => {
        if (!field.value.trim() && field.type !== "radio") {
          field.closest(".form-group").classList.add("error");
          isValid = false;
        }
      });
      const tipoSel = form.querySelector('input[name="tipo"]:checked');
      if (!tipoSel) {
        const anyRadio = form.querySelector('input[name="tipo"]');
        if (anyRadio) anyRadio.closest(".form-group").classList.add("error");
        isValid = false;
      }
      if (document.getElementById("receberWhatsapp").checked) {
        const w = whatsappInput.value.replace(/\\D/g, "");
        if (w.length !== 11) {
          whatsappInput.closest(".form-group").classList.add("error");
          isValid = false;
        }
      }
      return isValid;
    }

    // Envio
    document.getElementById("boletimForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      if (!validateForm()) { alert("Por favor, preencha todos os campos obrigat√≥rios corretamente."); return; }

      const submitBtn = document.getElementById("submitBtn");
      submitBtn.disabled = true; submitBtn.classList.add("loading"); submitBtn.textContent = "Enviando...";

      const formData = new FormData();
      formData.append("tipo", document.querySelector('input[name="tipo"]:checked').value);
      formData.append("data", document.getElementById("data").value);
      formData.append("hora", document.getElementById("hora").value);
      formData.append("local", document.getElementById("local").value);
      formData.append("empresa", document.getElementById("empresa").value);
      formData.append("comunicante", document.getElementById("comunicante").value);
      formData.append("colaborador", document.getElementById("colaborador").value);
      formData.append("relato", document.getElementById("relato").value);
      formData.append("receberWhatsapp", document.getElementById("receberWhatsapp").checked);
      if (document.getElementById("receberWhatsapp").checked) {
        formData.append("whatsapp", whatsappInput.value.replace(/\\D/g, ""));
      }
      uploadedPhotos.forEach((photo, index) => formData.append(\`foto_\${index}\`, photo));

      try {
        const response = await fetch("https://grupoparana-n8n.qkcade.easypanel.host/webhook-test/boletim-acidente", {
          method: "POST", body: formData
        });
        const data = await response.json();
        if (response.ok && (data?.success || data?.data)) {
          showSuccessModal(data);
        } else { throw new Error(data?.message || "Erro ao enviar formul√°rio"); }
      } catch (err) {
        console.error("Erro ao enviar:", err);
        alert("Erro ao enviar o boletim: " + err.message);
      } finally {
        submitBtn.disabled = false; submitBtn.classList.remove("loading"); submitBtn.textContent = "Enviar Boletim";
      }
    });

    // Data e hora atuais
    const now = new Date();
    document.getElementById("data").valueAsDate = now;
    document.getElementById("hora").value = now.toTimeString().slice(0, 5);
  </script>
</body>
</html>
